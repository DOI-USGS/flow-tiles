{
  "Comment": "Run gage-conditions and create the flow-tiles PNG",
  "StartAt": "Run gage-conditions",
  "TimeoutSeconds": 7200,
  "States": {
    "Run gage-conditions": {
      "Type": "Task",
      "Resource": "arn:aws:states:::ecs:runTask.sync",
      "Parameters": {
        "LaunchType": "FARGATE",
        "Cluster": "arn:aws:ecs:us-west-2:807615458658:cluster/vizlab-cluster",
        "TaskDefinition": "arn:aws:ecs:us-west-2:807615458658:task-definition/vizlab-gage-conditions-task:12",
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "Subnets": [
              "subnet-0b250cbaebb683b8d"
            ],
            "AssignPublicIp": "ENABLED"
          }
        }
      },
      "Next": "Create flow-tiles PNG",
      "Catch": [
        {
          "ErrorEquals": [ "States.ALL" ],
          "Next": "Notify gage-conditions Failure"
        }
      ]
    },
    "Create flow-tiles PNG": {
      "Type": "Task",
      "Resource": "arn:aws:states:::ecs:runTask.sync",
      "Parameters": {
        "LaunchType": "FARGATE",
        "Cluster": "arn:aws:ecs:us-west-2:807615458658:cluster/vizlab-cluster",
        "TaskDefinition": "arn:aws:ecs:us-west-2:807615458658:task-definition/vizlab-flow-tiles-task:11",
        "NetworkConfiguration": {
          "AwsvpcConfiguration": {
            "Subnets": [
              "subnet-0b250cbaebb683b8d"
            ],
            "AssignPublicIp": "ENABLED"
          }
        }
      },
      "Next": "Notify Success",
      "Catch": [
        {
          "ErrorEquals": [ "States.ALL" ],
          "Next": "Notify flow-tiles Failure"
        }
      ]
    },
    "Notify Success": {
      "Type": "Task",
      "Resource": "arn:aws:states:::sns:publish",
      "Parameters": {
        "Message": "The pipeline to build the flow-tiles visualization has run successfully. See the result: https://s3.console.aws.amazon.com/s3/buckets/vizlab-flow-tiles?region=us-west-2&prefix=out/&showversions=false",
        "TopicArn": "arn:aws:sns:us-west-2:807615458658:vizlab-flow-tiles-pipeline"
      },
      "End": true
    },
    "Notify gage-conditions Failure": {
      "Type": "Task",
      "Resource": "arn:aws:states:::sns:publish",
      "Parameters": {
        "Message": "The pipeline to build the flow-tiles visualization has FAILED in the gage-conditions task. See logs in the developer account: https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#logsV2:log-groups/log-group/$252Fecs$252Fgage-conditions-task",
        "TopicArn": "arn:aws:sns:us-west-2:807615458658:vizlab-flow-tiles-pipeline"
      },
      "End": true
    },
    "Notify flow-tiles Failure": {
      "Type": "Task",
      "Resource": "arn:aws:states:::sns:publish",
      "Parameters": {
        "Message": "The pipeline to build the flow-tiles visualization has FAILED in the flow-tiles task. See logs in the developer account: https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#logsV2:log-groups/log-group/$252Fecs$252Fflow-tiles-task",
        "TopicArn": "arn:aws:sns:us-west-2:807615458658:vizlab-flow-tiles-pipeline"
      },
      "End": true
    }
  }
}
